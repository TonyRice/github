omg: 1
lifecycle:
  startup:
    command: ["python", "/app/app.py"]
actions:
  api:
    help: Make an API request to the GitHub REST API
    arguments:
      method:
        required: true
        type: string
        in: requestBody
        default: get
        enum:
          - head
          - get
          - post
          - patch
          - put
          - delete
      url:
        required: true
        type: string
        in: requestBody
      data:
        type: map
        in: requestBody
        help: The data to post in the API request body.
      params:
        type: map
        in: requestBody
      headers:
        type: map
        in: requestBody
      token:
        type: string
        help: A oauth user access token to use during the request for authentication.
        in: requestBody
    output:
      type: map
    http:
      contentType: application/json
      port: 8000
      method: post
      path: /api

  graphql:
    help: Query GitHub GraphQL
    arguments:
      query:
        type: string
        in: requestBody
        required: true
      headers:
        type: map
        in: requestBody
      token:
        type: string
        help: A oauth user access token to use during the request for authentication.
        in: requestBody
    output:
      type: map
    http:
      contentType: application/json
      port: 8000
      method: post
      path: /graphql

  oauthRedirect:
    help: |
      Return the GitHub redirect url for login
    arguments:
      scope:
        type: list
        in: requestBody
        help: |
          List of scopes to use during login.
          https://developer.github.com/apps/building-oauth-apps/understanding-scopes-for-oauth-apps/
      redirect:
        type: string
        in: requestBody
        help: Where GitHub redirects successful logins to
      state:
        trpe: string
        in: requestBody
        help: An unguessable random string. It is used to protect against cross-site request forgery attacks.
    output:
      type: string
      # help: The full url to redirect for GitHub Login
    http:
      port: 8000
      method: post
      path: /login_redirect
      contentType: application/json

  oauthGetAccessToken:
    help: Return the GitHub redirect url for login
    arguments:
      code:
        type: string
        in: requestBody
        help: The code provided in the query of GitHub oauth call
      state:
        type: string
        in: requestBody
        help: A unique key for state tracking
    output:
      type: string
      # help: The GitHub oauth token, this variable should be kept secret
      # sensative: true
    http:
      port: 8000
      method: post
      path: /login_token
      contentType: application/json

  webhookValidate:
    help: Validate webhooks signature
    arguments:
      headers:
        type: map
        required: true
        in: requestBody
        help: The http headers provided by the GitHub http request
      body:
        type: string
        required: true
        in: requestBody
        help: The raw request body from GitHub
    output:
      type: object
      properties:
        valid:
          type: boolean
        event:
          type: string
    http:
      port: 8000
      method: post
      path: /webhook_validate
      contentType: application/json

environment:
  APP_ID:
    help: The GitHub App ID
    type: int
  HOSTNAME:
    help: The GitHub Hostname (for GitHub Enterprise)
    type: string
  API_HOSTNAME:
    help: The GitHub API Hostname (for GitHub Enterprise)
    type: string
  CLIENT_ID:
    help: The GitHub Oauth Client ID
    type: string
  CLIENT_SECRET:
    help: The GitHub Oauth Client Secret
    type: string
    # secret: true
  OAUTH_TOKEN:
    help: A user oauth token to be used if not provided during an action.
    type: string
    # secret: true
  WEBHOOK_SECRET:
    help: Used to check the webhook payload signature.
    type: string
    # secret: true
  USER_AGENT:
    help: GitHub requires a the User-Agent header defined.
    type: string
    default: 'Undefined'
